# render.yaml Configuration for BLFantasy
# Repository: moin7111/ElPatrons-Manger
# Auto-sync enabled: Changes to this file will automatically update services

databases:
  - name: blfantasy-postgres
    plan: basic-256mb # $10.50/month
    databaseName: blfantasy
    user: blfantasy_user
    # Optional: Set specific PostgreSQL version
    # version: "15"
    
    # IP Allow List (optional - for security)
    # ipAllowList:
    #   - source: 0.0.0.0/0
    #     description: Allow all IPs (not recommended for production)

services:
  # Web Service - API
  - type: web
    name: blfantasy-api
    runtime: python
    pythonVersion: 3.11
    plan: starter
    
    # Build configuration
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app.main:app --workers 2 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT
    
    # Environment configuration
    envVars:
      - key: API_KEY
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: blfantasy-postgres
          property: connectionString
      - key: NODE_ENV
        value: production
    
    # Health check endpoint
    healthCheckPath: /health
    
    # Scaling (for paid plans)
    # numInstances: 1
    
    # Domains (optional)
    # domains:
    #   - blfantasy.yourdomain.com

  # Background Worker
  - type: worker
    name: blfantasy-worker
    runtime: python
    plan: starter
    
    # Build configuration
    buildCommand: pip install -r requirements.txt
    startCommand: python -m jobs.worker
    
    # Environment configuration
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: blfantasy-postgres
          property: connectionString
      - key: WORKER_CONCURRENCY
        value: "5"
      - key: NODE_ENV
        value: production
    
    # Scaling (for paid plans)
    # numInstances: 1

  # Cron Job - Daily Ingest
  - type: cron
    name: daily-ingest
    runtime: python
    # plan not required for cron jobs (pay-per-run)
    
    # Cron schedule (daily at midnight UTC)
    schedule: "0 0 * * *"
    
    # Build configuration
    buildCommand: pip install -r requirements.txt
    startCommand: python -m jobs.daily_ingest
    
    # Environment configuration
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: blfantasy-postgres
          property: connectionString
      - key: JOB_TYPE
        value: daily_ingest

  # Cron Job - Prematch Pull
  - type: cron
    name: prematch-pull
    runtime: python
    # plan not required for cron jobs (pay-per-run)
    
    # Cron schedule (every 30 minutes)
    schedule: "*/30 * * * *"
    
    # Build configuration
    buildCommand: pip install -r requirements.txt
    startCommand: python -m jobs.prematch_pull
    
    # Environment configuration
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: blfantasy-postgres
          property: connectionString
      - key: JOB_TYPE
        value: prematch_pull
      - key: API_KEY
        sync: false

# Preview Environments (optional)
# previewsEnabled: true
# previewsExpireAfterDays: 3